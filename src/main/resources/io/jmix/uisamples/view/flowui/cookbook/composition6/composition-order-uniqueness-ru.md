Этот пример демонстрирует, как реализовать упорядочивание элементов композиции и обеспечить их уникальность в рамках корневой сущности.

Композиция состоит из сущностей `Order` и `OrderItem`. Если вы откроете заказ для редактирования, вы увидите таблицу данных с элементами заказа. Таблица содержит столбец **#**, отображающий номер строки. Вы можете перемещать элемент заказа вверх и вниз с помощью соответствующих кнопок. При создании нового элемента, или редактировании существующего, выпадающий список для выбора продукта содержит только те варианты, которые еще не были добавлены в заказ.

Детали реализации:

- [Order.java]({currentPath}?tab=Order.java)
  - Атрибут `Order.items` аннотирован с помощью `@Composition`.

- [OrderItem.java]({currentPath}?tab=OrderItem.java)
  - Атрибут `OrderItem.sortValue` хранит позицию элемента в рамках заказа.

- [OrderDetailView.java]({currentPath}?tab=OrderDetailView.java)
  - Обработчик `itemsDataGridCreateActionInitializer()` устанавливает начальное значение для `sortValue`, увеличивая максимальное значение, найденное среди существующих элементов.
  - Обработчик события `onItemsDcItemChange()` активирует и деактивирует кнопки **Up** и **Down** в зависимости от позиции выбранного элемента.
  - Слушатели событий `onUpButtonClick()` и `onDownButtonClick()` меняют значения `sortValue` между соседними элементами и переупорядочивают таблицу.
  - Обработчики `itemsDataGridCreateActionViewConfigurer()` и `itemsDataGridEditActionViewConfigurer()` передают список продуктов, уже выбранных в элементах заказа, в `OrderItemDetailView`. Этот список используется для удаления уже выбранных продуктов из доступных вариантов, что обеспечивает уникальность элементов в заказе.

- [OrderItemDetailView.java]({currentPath}?tab=OrderItemDetailView.java)
  - Обработчик `productFieldItemsFetchCallback()` загружает доступные продукты в соответствии с вводом пользователя и списком уже добавленных в заказ продуктов.